import{get,game,lib,_status,ui}from"noname";const e={twtanfeng:{async content(event,trigger,player){const result=await player.chooseTarget(get.prompt2("twtanfeng"),(card,e,t)=>t!==e&&t.countDiscardableCards(e,"hej")>0).set("ai",e=>{const t=_status.event.player;let a=1;return get.attitude(t,e)>0?a=3:e.countCards("he")&&e.canUse("sha",t)||(a=e.hp+e.countCards("hs",{name:["tao","jiu"]})<=1?2:1.2),get.effect(e,{name:"guohe"},t,t)*a*(t.hp<=1&&get.attitude(t,e)<=0?0:1)}).setHiddenSkill("twtanfeng").forResult();if(!result?.bool)return;const e=result.targets[0];event.target=e,player.logSkill("twtanfeng",e),await player.discardPlayerCard(e,"hej",!0);const t=e.chooseToUse();t.set("openskilldialog",`###探锋：选择一张牌当作【杀】对${get.translation(player)}使用###或点击"取消"，受到其造成的1点火焰伤害，并令其跳过本回合的一个阶段（准备阶段和结束阶段除外）`),t.set("norestore",!0),t.set("_backupevent","twtanfeng_backup"),t.set("custom",{add:{},replace:{window(){}}}),t.backup("twtanfeng_backup"),t.set("targetRequired",!0),t.set("complexSelect",!0),t.set("filterTarget",(card,e,t)=>!(t!==_status.event.sourcex&&!ui.selected.targets.includes(_status.event.sourcex))&&(card&&lib.filter.targetEnabled(card,e,t))),t.set("sourcex",player),t.set("addCount",!1);const a=await t;if(a?.bool)return;if(player.line(e,"fire"),await e.damage(1,"fire"),!e.isIn())return;const s={phaseJudge:"判定阶段",phaseDraw:"摸牌阶段",phaseUse:"出牌阶段",phaseDiscard:"弃牌阶段"},n=Object.entries(s).filter(([e])=>!player.skipList.includes(e)).map(([,e])=>e),o=n.filter(e=>"判定阶段"!==e&&"弃牌阶段"!==e),r=await e.chooseControl(n).set("prompt",`探锋：令${get.translation(player)}跳过一个阶段`).set("ai",()=>_status.event.choice).set("choice",(()=>{const t=get.attitude(e,player),a=player.countCards("j");return t>0?n.includes("判定阶段")&&a>0?"判定阶段":"弃牌阶段":n.includes("摸牌阶段")&&player.hasJudge("lebu")?"摸牌阶段":n.includes("出牌阶段")&&player.hasJudge("bingliang")||player.needsToDiscard()>0?"出牌阶段":o.randomGet()})()).forResult();for(const[i,l]of Object.entries(s))l===r.control&&player.skip(i);e.popup(r.control),e.line(player),game.log(player,"跳过了",`#y${r.control}`)},subSkill:{backup:{viewAs:{name:"sha"},filterCard:!0,position:"hes",check(card){const player=_status.event.player,e=_status.event.getParent().player,t=get.effect(e,get.autoViewAs({name:"sha"},[card]),player,player),a=get.damageEffect(player,e,player,"fire");return t<0||a>0||a>t||get.tag(card,"recover")?0:(1===player.hp?10:6)-get.value(card)}}}},olhedao:{tianshuClear(e,player,t=1){t>0&&get.info(e)?.nopop&&(game.broadcastAll((e,t)=>{delete lib.skill[t].nopop,lib.skill[t].markimage="image/card/tianshu1.png",e.marks[t]&&e.marks[t].text.setBackgroundImage(lib.skill[t].markimage)},player,e),player.update()),player.storage[e][0]-=t,player[player.storage[e][0]<=0?"removeSkill":"markSkill"](e)}}};export{e as inheritComplexSkill};
