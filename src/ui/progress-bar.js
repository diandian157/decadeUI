import{game,lib,_status,ui,get}from"noname";import{initGTBB as e}from"./gtbb.js";import{initPhaseTipsSkills as t}from"./phase-tips.js";const a="jindutiaopl",i=[0,0,100,100],s=395/3,o=100,n=e=>{window[e]&&(clearInterval(window[e]),delete window[e])},r=e=>document.getElementById(e)?.remove(),l=()=>{const e=lib.config.extension_十周年UI_newDecadeStyle;return"on"!==e&&"othersOff"!==e},p=(e,t)=>{e.getElementsByClassName(t)[0]?.remove()},d=(e,t)=>{const a=document.createElement("img");return a.src=`${lib.assetURL}${e}`,a.style.cssText=t,a},c=(e,t)=>{const a=document.createElement("div");return a.data=e,a.style.cssText=t,a},h=(e,t)=>{const a=document.createElement("img");return a.classList.add("tipshow",e),a.src=`${lib.assetURL}extension/十周年UI/ui/assets/lbtn/shoushatip/${t}`,a.style.cssText=l()?"display:block;position:absolute;z-index:91;--w:133px;--h:calc(var(--w)*50/431);width:var(--w);height:var(--h);bottom:-22px;":"display:block;position:absolute;z-index:92;--w:129px;--h:calc(var(--w)*50/431);width:var(--w);height:var(--h);bottom:-20px;transform:scale(1.2);",a};function m(){game.Jindutiaoplayer=()=>{n("timer"),n("timer2"),r(a);const e=document.createElement("div");e.id=a;const t=(()=>{const e=lib.config.extension_十周年UI_jindutiaoYangshi,t=parseFloat(lib.config["extension_十周年UI_jindutiaoSet"])+"%",a={1:{container:{backgroundColor:"rgba(0,0,0,0.4)",width:"620px",height:"12.3px",borderRadius:"1000px",boxShadow:"0px 0px 9px #2e2b27 inset,0px 0px 2.1px #FFFFD5",overflow:"hidden",border:"1.2px solid #000000",position:"fixed",left:"calc(50% - 300px)",bottom:t},progressBar:{data:620,style:"background-image: linear-gradient(#fccc54 15%, #d01424 30%, #cc6953 90%);height:12.8px;"},clearSpecial:!0},2:{container:{width:"400px",height:"24px",display:"block",left:"calc(50% - 197px)",position:"fixed",bottom:t},progressBar:{data:300,style:"width:280px;height:4.3px;margin:14px 0 0 85px;background-color:#E2E20A;border-right:5px solid #FFF;position:absolute;top:-3.5px;"},backgroundImage:{src:"extension/十周年UI/ui/assets/lbtn/uibutton/jindutiao.png",style:"--w:400px;--h:calc(var(--w)*44/759);width:var(--w);height:var(--h);position:absolute;top:0;"},clearSpecial:!0},3:{container:{width:"400px",height:"13px",display:"block",boxShadow:"0 0 4px #000000",margin:"0 0 !important",position:"fixed",left:"calc(50% - 197px)",bottom:t},progressBar:{data:395,style:"z-index:1;width:399px;height:8px;margin:0 0 0 1px;background-color:#F4C336;border-top:3px solid #EBE1A7;border-bottom:2px solid #73640D;border-left:1px solid #73640D;position:absolute;top:0px;border-radius:3px;"},secondaryBar:{data:395,style:"width:399px;height:0.1px;margin:0 0 0 0.5px;background-color:#fff;opacity:0.8;border-top:1px solid #FFF;border-bottom:1px solid #FFF;border-left:1px solid #FFF;position:absolute;top:17px;border-radius:2px;"},backgroundImages:[{src:"extension/十周年UI/ui/assets/lbtn/uibutton/jindutiao2.1.png",style:"width:400px;height:4px;position:absolute;top:16px;z-index:-1;"},{src:"extension/十周年UI/ui/assets/lbtn/uibutton/jindutiao2.png",style:"width:400px;height:13px;position:absolute;top:0;opacity:0;"},{src:"extension/十周年UI/ui/assets/lbtn/uibutton/jindutiao2.1.png",style:"width:400px;height:14px;position:absolute;top:0;z-index:-1;"}],setSpecial:!0},4:{container:{width:"450px",height:"13px",display:"block",margin:"0 0 !important",position:"fixed",left:"calc(50% - 220px)",bottom:t,backgroundColor:"#4B3621",borderRadius:"6px"},progressBar:{data:449,style:"z-index:1;width:449px;height:12px;margin:0;background-color:rgb(230,151,91);position:absolute;top:1px;border-radius:6px;"},clearSpecial:!0}};return a[e]??a[1]})();t.clearSpecial&&delete window.jindutiaoTeshu,t.setSpecial&&!window.jindutiaoTeshu&&(window.jindutiaoTeshu=!0),Object.assign(e.style,t.container);const i=c(t.progressBar.data,t.progressBar.style);e.appendChild(i);let o=null,l=null;t.secondaryBar&&(o=c(t.secondaryBar.data,t.secondaryBar.style),e.appendChild(o)),t.backgroundImage&&e.appendChild(d(t.backgroundImage.src,t.backgroundImage.style)),t.backgroundImages&&t.backgroundImages.forEach((t,a)=>{const i=d(t.src,t.style);0===a&&(l=i),e.appendChild(i)}),document.body.appendChild(e);const p=parseFloat(lib.config.extension_十周年UI_jindutiaoST);window.timer=setInterval(()=>{i.style.width=`${i.data}px`,i.style.backgroundColor=i.data<=s?"rgba(230,56,65,0.88)":"rgb(230,151,91)",0===--i.data&&(n("timer"),e.remove())},p),window.jindutiaoTeshu&&o&&l&&(window.timer2=setInterval(()=>{o.style.width=--o.data+"px",0===o.data&&(n("timer2"),delete window.jindutiaoTeshu,o.remove(),l.remove())},p/2))},game.as_removeText=()=>{_status.as_showText?.remove(),delete _status.as_showText,_status.as_showImage?.show()},game.as_showText=(e,t,a,s="shousha",o=16,n="#ffffff")=>{if(!e)return!1;t=Array.isArray(t)?t:i,a=!0===a||"number"==typeof a?a:3,game.as_removeText();const r=ui.create.div("",e,ui.window);return r.style.cssText=`z-index:-3;pointer-events:none;font-family:${s};font-size:${o}px;color:${n};line-height:${1.2*o}px;text-align:center;left:${t[0]+t[2]/2}%;top:${t[1]}%;width:0%;height:${t[3]}%;position:absolute;transition:all 1s`,_status.as_showText=r,_status.as_showImage?.hide(),setTimeout(()=>{r.style.left=`${t[0]}%`,r.style.width=`${t[2]}%`},1),!0!==a&&setTimeout(game.as_removeText,1e3*a),!0},game.as_removeImage=()=>{if(_status.as_showImage){const e=_status.as_showImage;e.style.animation="left-to-right-out 1s",delete _status.as_showImage,setTimeout(()=>e.remove(),1e3)}},game.as_showImage=(e,t,a)=>{if(!e)return!1;t=Array.isArray(t)?t:i,a=!0===a||"number"==typeof a?a:3,game.as_removeImage();const s=ui.create.div("","",ui.window);return s.style.cssText=`z-index:-1;pointer-events:none;left:${t[0]}%;top:${t[1]}%;width:8%;height:${t[3]}%;position:absolute;background-size:100% 100%;background-position:center;background-image:url(${lib.assetURL}${e});transition:all 1s`,_status.as_showImage=s,_status.as_showText&&s.hide(),!0!==a&&setTimeout(game.as_removeImage,1e3*a),!0}}const u=e=>{let t=!1,i=!1,s=[],d=null;const c=()=>{t||(t=!0,game.Jindutiaoplayer())},h=()=>{t&&(t=!1,n("timer"),n("timer2"),r(a))};window.resetProgressBarState=()=>{t=!1};const m=player=>{if(!player||player===game.me||s.includes(player))return;s.push(player),p(player,"timeai"),p(player,"timePhase");const{container:e,boxTime:t}=(e=>{const t=document.createElement("div"),a=document.createElement("div"),i=document.createElement("img"),s=l();return t.classList.add(e?"timePhase":"timeai"),s?(t.style.cssText="display:block;position:absolute;z-index:90;--w:122px;--h:calc(var(--w)*4/145);width:var(--w);height:var(--h);left:3.5px;bottom:-6.2px;",a.data=125,a.style.cssText="z-index:92;--w:33px;--h:calc(var(--w)*4/120);width:var(--w);height:var(--h);margin:1px;background-color:#dd9900;position:absolute;top:0;",i.src=`${lib.assetURL}extension/十周年UI/ui/assets/lbtn/uibutton/time.png`,i.style.cssText="position:absolute;z-index:91;--w:122px;--h:calc(var(--w)*4/145);width:var(--w);height:var(--h);top:0;"):(t.style.cssText="display:block;position:absolute;z-index:90;--w:122px;--h:calc(var(--w)*8/162);width:var(--w);height:var(--h);left:1.5px;bottom:-14px;",a.data=120,a.style.cssText="z-index:91;width:115px;height:3.3px;margin:1px;background-color:#f2c84b;position:absolute;top:0;border-radius:3px;",i.src=`${lib.assetURL}extension/十周年UI/ui/assets/lbtn/uibutton/timeX.png`,i.style.cssText="position:absolute;z-index:90;--w:122px;--h:calc(var(--w)*8/162);width:var(--w);height:var(--h);top:0;"),t.appendChild(a),t.appendChild(i),{container:t,boxTime:a}})(_status.currentPhase===player);player.appendChild(e);const a=`timerai_${player.playerid}`;window[a]=setInterval(()=>{t.style.width=--t.data+"px",0===t.data&&(n(a),e.remove())},150)},u=()=>{(i||s.length)&&(i=!1,s.forEach(e=>{n(`timerai_${e.playerid}`),p(e,"timeai"),p(e,"timePhase")}),s=[])},g=()=>{const event=_status.event;var player;event?.player&&(_status.paused||_status.imchoosing)?"wuxie"===event?.type?("0"!==lib.config.extension_十周年UI_jindutiaoYangshi&&c(),i&&s.length>1||(u(),i=!0,game.players.forEach(e=>e!==game.me&&m(e)))):event.player===game.me?(u(),"0"!==lib.config.extension_十周年UI_jindutiaoYangshi&&c()):(h(),(player=event.player)&&player!==game.me&&(i&&1===s.length&&s[0]===player||(u(),i=!0,m(player)))):(h(),u())},x=setInterval(()=>{_status.gameStarted&&(clearInterval(x),d||(d=setInterval(g,o)))},o);lib.onover.push(()=>{d&&(clearInterval(d),d=null),h(),u()})};function g(a){lib.removeFirstByClass=lib.removeFirstByClass||((e,t)=>e.getElementsByClassName(t)[0]?.remove()),lib.createTipImg=lib.createTipImg||((e,t,a)=>{const i=document.createElement("img");return i.classList.add("tipshow",e),i.src=t,i.style.cssText=a,i}),t(),"connect"!==get.mode()?(u(),(()=>{let e=null,t=null;const a=()=>{if(!_status.gameStarted||!game.players)return;const a=_status.currentPhase;a&&a!==game.me&&a.isPhaseUsing?.()?e!==a&&(e&&p(e,"playertip"),e=a,a.getElementsByClassName("playertip")[0]||a.appendChild(h("playertip",l()?"tip.png":"phasetip.png"))):e&&(p(e,"playertip"),e=null);const event=_status.event;"phaseDiscard"===event?.name&&event.player!==game.me?t!==event.player&&(t&&p(t,"playertipQP"),t=event.player,event.player.getElementsByClassName("playertipQP")[0]||event.player.appendChild(h("playertipQP",l()?"tipQP.png":"discardtip.png"))):t&&(p(t,"playertipQP"),t=null)},i=setInterval(()=>{_status.gameStarted&&(clearInterval(i),setInterval(a,o))},o)})(),(()=>{if(!l())return;const e={sha:{cls:"playertipsha",img:"tipsha.png"},shan:{cls:"playertipshan",img:"tipshan.png"},tao:{cls:"playertiptao",img:"tiptao.png"},jiu:{cls:"playertipjiu",img:"tipjiu.png"}},t=/* @__PURE__ */new Map;lib.announce.subscribe("Noname.Game.Event.Trigger",a=>{const{name:i,event:event}=a;if(!["useCardBegin","respondBegin"].includes(i))return;if(!event?.card||event.player===game.me)return;const s=event.card.name||event.card.viewAs,o=e[s];o&&!event.player.getElementsByClassName(o.cls)[0]&&(p(event.player,"tipskill"),event.player.appendChild(h(o.cls,o.img)),t.set(event.player,o.cls))}),lib.announce.subscribe("Noname.Game.Event.Trigger",e=>{const{name:a}=e;["useCardEnd","respondEnd","phaseBegin","phaseEnd","dieBegin"].includes(a)&&(t.forEach((e,player)=>p(player,e)),t.clear())})})(),e()):e()}export{m as initPrecontentUI,g as registerLegacyModules};
