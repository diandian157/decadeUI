import{ui,_status,lib,game}from"noname";const e=()=>!1!==lib.config.extension_十周年UI_autoSelect,t=(event,e)=>{const t=event[`select${e}`];if(void 0===t)return[1,1];if("number"==typeof t)return[t,t];if("function"==typeof t){const result=t();return"number"==typeof result?[result,result]:Array.isArray(result)?result:[1,1]}return Array.isArray(t)?t:[1,1]},n=()=>{const e=ui.selected.cards?.map(e=>e.cardid||e.name).join(",")||"";return`${_status.event?.skill||""}|${e}`},r=event=>{if(!e()||!event.filterCard||_status.auto)return!1;if(event.noAutoSelect||event.complexSelect||event.complexCard)return!1;if(!(event=>{if("chooseToRespond"===event.name||event.respondTo||"wuxie"===event.type)return!0;if("phaseDiscard"===event.name)return!1;const e=event.getParent?.();if("phaseDiscard"===e?.name)return!1;if("chooseToRespond"===e?.name||e?.respondTo)return!0;if("dying"===e?.name||event.dying)return!0;if(event.forceDirect)return!0;if("chooseCard"===event.name&&!event.dialog?.querySelector(".buttons")){const e=t(event,"Card");if(1===e[0]&&1===e[1])return!0}if("chooseToDiscard"===event.name){const e=t(event,"Card");if(1===e[0]&&1===e[1]){const e=event.position;if(!event.ai||"he"!==e&&"hes"!==e)return!0}}return!1})(event))return!1;if(event._manualCardCancel)return!1;const n=t(event,"Card");if(n[0]!==n[1])return!1;if("chooseToDiscard"===event.name&&n[0]>1&&event.ai){const e=event.position;if("he"===e||"hes"===e)return!1}return!event._autoCardDone},a=()=>{const event=_status.event;if(!(event=>{if(!e()||!event.filterTarget||_status.auto)return!1;if(event.noAutoSelect||event.complexSelect||event.complexTarget)return!1;if(event._manualTargetCancel)return!1;const r=t(event,"Target");if(r[0]!==r[1])return!1;const a=n();return event._autoTargetState!==a})(event))return!1;const r=game.players.filter(e=>e.classList.contains("selectable")&&!e.classList.contains("selected")),a=ui.selected.targets?.length||0,c=t(event,"Target")[0]-a;return c>0&&r.length===c&&(r.forEach(e=>{e.classList.add("selected"),ui.selected.targets.add(e)}),event._autoTargetState=n(),!0)},c=event=>{event&&(delete event._autoCardDone,delete event._autoTargetState,delete event._manualTargetCancel,delete event._manualCardCancel)};function o(){const e=ui.click.cancel;ui.click.cancel=function(){return c(_status.event),e.apply(this,arguments)};const n=ui.click.card;ui.click.card=function(){const event=_status.event;return event&&(this.classList?.contains("selected")?(delete event._autoCardDone,delete event._autoTargetState,delete event._manualTargetCancel,event._manualCardCancel=!0):(delete event._manualCardCancel,delete event._manualTargetCancel,event._autoCardDone=!0)),n.apply(this,arguments)};const o=ui.click.skill;ui.click.skill=function(){return c(_status.event),o.apply(this,arguments)};const s=ui.click.target;ui.click.target=function(){const event=_status.event;return event&&this.classList?.contains("selected")&&(delete event._autoTargetState,event._manualTargetCancel=!0),s.apply(this,arguments)},lib.hooks?.checkEnd?.add("_decadeUI_autoSelect",(event,{ok:e})=>{e||setTimeout(()=>{if(_status.event!==event)return;if(_status.paused&&!_status.imchoosing)return;const e=(()=>{const event=_status.event;if(!r(event))return!1;const player=event.player;if(!player)return!1;const e=player.getCards(event.position||"h").filter(card=>card.classList.contains("selectable")&&!card.classList.contains("selected")),n=ui.selected.cards?.length||0,a=t(event,"Card")[0]-n;return a>0&&e.length>=a&&(e.slice(0,a).forEach(card=>{card.classList.add("selected"),ui.selected.cards.add(card),card.updateTransform?.(!0)}),event._autoCardDone=!0,!0)})()||a();e&&(game.check(),event.forced||event.fakeforce||"o"!==ui.confirm?.str||ui.create.confirm("oc"))},0)})}export{o as setupAutoSelect};
