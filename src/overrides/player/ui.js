import{game,get,lib,ui,_status}from"noname";let e=null;function t(e){e=e.replace(/##assetURL##/g,lib.assetURL);const t=document.createElement("div");t.innerHTML=e;if(""===(t.textContent||t.innerText||"").trim()&&t.querySelectorAll("img").length>0){if(!this.$chatImage||!this.$chatImage.parentNode){this.$chatImage=decadeUI.element.create("chat-image"),this.$chatImage.style.position="absolute",this.$chatImage.style.pointerEvents="none";const e=decadeUI.config.newDecadeStyle;"off"===e||"on"===e||"othersOff"===e?(this.$chatImage.style.left="50%",this.$chatImage.style.top="50%",this.$chatImage.style.transform="translate(-50%, -50%)",this.$chatImage.style.zIndex="90"):(this.$chatImage.style.left="-40%",this.$chatImage.style.top="-50px",this.$chatImage.style.transform="translateX(-50%)",this.$chatImage.style.zIndex="90")}const t=this.$chatImage;t.innerHTML=e;t.querySelectorAll("img").forEach(e=>{e.style.width||e.style.height||(e.style.width="100px",e.style.height="auto",e.style.maxWidth="100px")}),this!=t.parentNode&&this.appendChild(t),t.classList.remove("removing"),t.style.animation="fade-in 0.3s",t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout(()=>{t.timeout=void 0,t.delete(),this.$chatImage=void 0},2e3)}else{this.$chatBubble||(this.$chatBubble=decadeUI.element.create("chat-bubble"));const t=this.$chatBubble;t.innerHTML=e,this!=t.parentNode&&this.appendChild(t),t.classList.remove("removing"),t.style.animation="fade-in 0.3s",t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout(()=>{t.timeout=void 0,t.delete()},2e3)}const i=get.translation(this.name),s=[i?`${i}[${this.nickname}]`:this.nickname,e];lib.chatHistory.push(s),_status.addChatEntry&&(_status.addChatEntry._origin.parentNode?_status.addChatEntry(s,!1):_status.addChatEntry=void 0),lib.config.background_speak&&lib.quickVoice.includes(e)&&game.playAudio("voice","female"===this.sex?"female":"male",lib.quickVoice.indexOf(e))}function i(e){if(this!=game.me)return;e||(e=this.expandedSlots||{}),game.addVideo("$syncExpand",this,get.copy(e)),game.broadcast(function(player,e){player.expandedSlots=e,player.$syncExpand(e)},this,e);let t;for(this[lib.skill.expandedSlots.intro.markcount(null,game.me)>0?"markSkill":"unmarkSkill"]("expandedSlots");t=ui.equipSolts.back.firstChild;)t.remove();const i=this.expandedSlots,s=ui.equipSolts;for(let n=0;n<5;n++){if(i&&i["equip"+(n+1)])for(let e=0;e<i["equip"+(n+1)];e++){decadeUI.element.create(null,s.back).dataset.type=n}decadeUI.element.create(null,s.back).dataset.type=n}}function s(e,t){if(!get.character(e))return;const i=this.node?.[t?"name2":"name"],s=this.node?.[t?"avatar2":"avatar"];if(!i)return;const n=()=>{i.textContent.endsWith("•体验")||(i.textContent=`${i.textContent}•体验`)},a=s?.style?.backgroundImage;if(!a)return void n();const o=a.match(/url\(["']?([^"')]+)["']?\)/);if(!o?.[1])return void n();const h=o[1],d=new Image;d.onload=()=>{i.textContent.endsWith("•体验")&&(i.textContent=i.textContent.slice(0,-3))},d.onerror=n,d.src=h}function n(){const player=this;if(!player.node.showCards)return;if(player==game.me||player.isDead()){for(player.node.showCards.hide();player.node.showCards.hasChildNodes();)player.node.showCards.removeChild(player.node.showCards.firstChild);return}const e=player.getCards("h",e=>get.is.shownCard(e)||void 0!==game.me&&player.isUnderControl(!0)||game.me&&game.me.hasSkillTag("viewHandcard",null,player,!0));if(e.length){for(player.node.showCards.show();player.node.showCards.hasChildNodes();)player.node.showCards.removeChild(player.node.showCards.firstChild);for(let i=0;i<5;i++)t("div",{class:["handcard"],innerHTML:i<e.length?lib.translate[e[i].name].slice(0,2):"",parentNode:player.node.showCards})}else player.node.showCards.hide();function t(e,t={}){const i=document.createElement(e);for(const s in t){if(!Object.hasOwnProperty.call(t,s))continue;const e={class:e=>e.forEach(e=>i.classList.add(e)),id:e=>i.id=e,parentNode:e=>e.appendChild(i),listen:e=>{for(const t in e)"function"==typeof e[t]&&(i[t]=e[t])},style:e=>{for(const t in e)i.style[t]=e[t]},children:e=>e.forEach(e=>i.appendChild(e)),insertBefore:e=>e[0].insertBefore(i,e[1])};"innerHTML"==s||"innerText"==s?i[s]=t[s]:e[s]&&e[s](t[s])}return i}}function a(t){let i;const s=(e||(e=window.decadeUI),e).boundsCaches.arena;s.check(),this.cacheReferW==s.width&&this.cacheReferH==s.height&&this.cachePosition==this.dataset.position||(i=!0),this.cacheReferW=s.width,this.cacheReferH=s.height,this.cachePosition=this.dataset.position,null===this.cacheLeft&&(i=!0),(i||t)&&(this.cacheLeft=this.offsetLeft,this.cacheTop=this.offsetTop,this.cacheWidth=this.offsetWidth,this.cacheHeight=this.offsetHeight)}export{s as playerCheckAndAddExperienceSuffix,a as playerCheckBoundsCache,t as playerSay,i as playerSyncExpand,n as playerUpdateShowCards};
