import{game,_status}from"noname";import"../../animation/utils.js";import{DynamicPlayer as i}from"../../animation/DynamicPlayer.js";function n(n,t){if(t=!0===t,void 0===n)return console.error("playDynamic: 参数1不能为空");let a=this.dynamic;a?t&&a.deputy?(a.stop(a.deputy),a.deputy=null):a.primary&&(a.stop(a.primary),a.primary=null):(a=new i(window.decadeUIPath+"assets/dynamic/"),a.dprAdaptive=!0,this.dynamic=a,this.$dynamicWrap.appendChild(a.canvas)),"string"==typeof n&&(n={name:n}),this.doubleAvatar&&(n=function(i,n){const result={...i};Array.isArray(result.x)?(result.x=[...result.x],result.x[1]+=n?.25:-.25):void 0===result.x?result.x=[0,n?.75:.25]:result.x=[result.x,n?.25:-.25];return result.clip={x:[0,n?.5:0],y:0,width:[0,.5],height:[0,1],clipParent:!0},result}(n,t)),this.$dynamicWrap.parentNode!==this&&this.appendChild(this.$dynamicWrap),a.outcropMask=window.decadeUI?.config?.dynamicSkinOutcrop;const e=a.play(n);t?a.deputy=e:a.primary=e,this.classList.add(t?"d-skin2":"d-skin")}function t(i,n){const t=this.dynamic;t&&(n=!0===n,(i=!0===i)&&t.primary?(t.stop(t.primary),t.primary=null):n&&t.deputy?(t.stop(t.deputy),t.deputy=null):i||n||(t.stopAll(),t.primary=null,t.deputy=null),t.primary||t.deputy||(this.classList.remove("d-skin","d-skin2"),this.$dynamicWrap.remove()))}function a(){const i=window.decadeUI;if("function"==typeof game.qhly_changeDynamicSkin)return this.name1&&game.qhly_changeDynamicSkin(this,void 0,this.name1,!1,!0),void(this.doubleAvatar&&this.name2&&game.qhly_changeDynamicSkin(this,void 0,this.name2,!0,!0));if(!i?.config?.dynamicSkin||null===_status.mode)return;if(i.CUR_DYNAMIC??=0,i.MAX_DYNAMIC??=function(){const i=window.decadeUI?.isMobile?.()?2:10,n=window.OffscreenCanvas?8:0;return i+n}(),!this.dynamic&&i.CUR_DYNAMIC>=i.MAX_DYNAMIC)return;const n=i.dynamicSkin;if(!n)return;const t=this.doubleAvatar&&this.name2?[this.name1,this.name2]:[this.name1];let a=!1;t.forEach((t,e)=>{const r=n[t];if(!r)return;const o=Object.keys(r);if(!o.length)return;const s=r[o[0]];if(!s?.name)return;const c=function(i){const n={name:i.name,action:i.action,loop:!0,loopCount:-1,speed:i.speed??1,filpX:i.filpX,filpY:i.filpY,opacity:i.opacity,x:i.x,y:i.y,scale:i.scale,angle:i.angle,hideSlots:i.hideSlots,clipSlots:i.clipSlots};(i.player||void 0!==i._transform)&&(n.player={...i.player||{},...void 0!==i._transform&&{_transform:i._transform}});return n}(s);this.playDynamic(c,1===e),s.background?this.$dynamicWrap.style.backgroundImage=`url("${window.decadeUIPath}assets/dynamic/${s.background}")`:this.$dynamicWrap.style.removeProperty("background-image"),a||(a=!0,i.CUR_DYNAMIC++)})}export{a as playerApplyDynamicSkin,n as playerPlayDynamic,t as playerStopDynamic};
