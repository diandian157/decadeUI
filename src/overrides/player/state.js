import{get,game,lib,ui,_status}from"noname";import{getBasePlayerMethods as t}from"./base.js";function e(e){const result=t().awakenSkill.apply(this,arguments);if(ui.updateSkillControl?.(this),get.info(e)?.dutySkill){const t=this;game.expandSkills([e]).forEach(e=>{t.setSkillState(e,"shixiao")})}const i=_status.event.getParent()?.skill;return i?.endsWith("_fail")&&i.slice(0,-5)===e&&this.setSkillState(e,"fail"),result}function i(t){return t=t||this.identity,this.node.identity.dataset.color=t,"guozhan"===get.mode()?("ye"===t&&get.is.jun(this)&&(this.identity=t=lib.character[this.name1][1]),this.group=t,this.node.identity.firstChild.innerHTML=get.translation(t),this):(get.is.jun(this)?this.node.identity.firstChild.innerHTML="君":this.node.identity.firstChild.innerHTML=get.translation(t),this)}function n(){const e=t().getState.apply(this,arguments);return e.seat=this.seat,e}function s(e){e?.seat&&this.node.seat&&(this.node.seat.innerHTML=get.cnNumber(e.seat,!0));return t().setModeState.apply(this,arguments)}function a(){t().setSeatNum.apply(this,arguments),this.seat=this.getSeatNum(),game.broadcastAll(player=>{const t=player.getSeatNum?.()??player.seat;player.node.seat&&(player.node.seat.innerHTML=get.cnNumber(t,!0))},this)}function o(){window.decadeModule?.prefixMark&&window.decadeModule.prefixMark.clearPrefixMarks(this),this.stopDynamic(),this.doubleAvatar=!1,delete this.node.campWrap.dataset.camp;const e=this.node.campWrap.node.campName;for(;e.firstChild;)e.removeChild(e.lastChild);e.style.removeProperty("background-image");const i=this.node.hpWrap.querySelector(".hujia");i&&i.remove(),this.node.showCards?.hide();return t().$uninit.apply(this,arguments),this}function r(e,i,n,s){t().$reinit.apply(this,arguments);const a=this.name1||this.name;return window.decadeModule?.prefixMark&&(window.decadeModule.prefixMark.clearPrefixMarks(this),a&&window.decadeModule.prefixMark.showPrefixMark(a,this),this.doubleAvatar&&this.name2&&window.decadeModule.prefixMark.showPrefixMark(this.name2,this)),this.node.name&&a&&(this.node.name.innerHTML=get.slimNameHorizontal?.(a)||get.slimName(a)),this.doubleAvatar&&this.node.name2&&this.name2&&(this.node.name2.innerHTML=get.slimNameHorizontal?.(this.name2)||get.slimName(this.name2)),this}async function d(e,i,n){this.stopDynamic();const result=t().reinitCharacter.apply(this,arguments);return await Promise.resolve(result),this._decadeUIApplyDynamicSkin(),result}function h(){return t().$update.apply(this,arguments),function(player){let t=player.node.hpWrap.querySelector(".hujia");player.hujia>0?(t||(t=ui.create.div(".hujia"),player.node.hpWrap.appendChild(t)),t.innerText=player.hujia===1/0?"∞":player.hujia):t&&t.remove()}(this),function(player){const t=player.classList.contains("unseen_show")||player.classList.contains("unseen2_show"),e=player.hp,i=t?1:player.maxHp,n=player.node.hp,s=i>5||player.hujia&&i>3;if(!player.storage.nohp&&s){const t=isNaN(e)?"×":e===1/0?"∞":e,s=isNaN(i)?"×":i===1/0?"∞":i;n.innerHTML=`${t}<br>/<br>${s}<div></div>`,0===e&&n.lastChild.classList.add("lost"),n.classList.add("textstyle")}player.dataset.maxHp=s?4:i}(this),function(player){const t=player.countCards("h");if(player===game.me){const e=lib.config.extension_十周年UI_newDecadeStyle,i=["onlineUI","babysha","codename"].includes(e);player.node.count.innerHTML=i?`${t}/${player.getHandcardLimit()}`:t}else t>=10&&(player.node.count.innerHTML=t)}(this),this.decadeUI_updateShowCards(),this}export{e as playerAwakenSkill,n as playerGetState,r as playerReinit,d as playerReinitCharacter,i as playerSetIdentity,s as playerSetModeState,a as playerSetSeatNum,o as playerUninit,h as playerUpdate};
