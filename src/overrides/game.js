import{game,lib,ui,get,_status}from"noname";let e=null;function a(a){e=a}function r(a,r,t,n,s){e.swapSeat.apply(this,arguments),a.seat=a.getSeatNum(),a.node.seat&&(a.node.seat.innerHTML=get.cnNumber(a.seat,!0)),r.seat=r.getSeatNum(),r.node.seat&&(r.node.seat.innerHTML=get.cnNumber(r.seat,!0))}function t(player,a){const r=[game.me,player],result=e.swapPlayer.call(this,player,a);return lib.config.extension_十周年UI_aloneEquip&&game.me&&game.me!==ui.equipSolts?.me&&(ui.equipSolts.me.appendChild(ui.equipSolts.equips),ui.equipSolts.me=game.me,ui.equipSolts.equips=game.me.node.equips,ui.equipSolts.appendChild(game.me.node.equips),game.me.$syncExpand()),r.forEach(e=>e.decadeUI_updateShowCards()),lib.refreshPlayerSkills&&r.forEach(e=>lib.refreshPlayerSkills(e)),lib.clearAllSkillDisplay&&lib.clearAllSkillDisplay(),lib.refreshPlayerSkills&&game.players.concat(game.dead||[]).forEach(e=>lib.refreshPlayerSkills(e)),result}function n(player){const result=e.swapControl.call(this,player);return lib.config.extension_十周年UI_aloneEquip&&game.me&&game.me!==ui.equipSolts?.me&&(ui.equipSolts.me.appendChild(ui.equipSolts.equips),ui.equipSolts.me=game.me,ui.equipSolts.equips=game.me.node.equips,ui.equipSolts.appendChild(game.me.node.equips),game.me.$syncExpand()),ui.equipSolts&&(game.me&&"function"==typeof game.me.$handleEquipChange&&game.me.$handleEquipChange(),player&&"function"==typeof player.$handleEquipChange&&player.$handleEquipChange()),player.decadeUI_updateShowCards(),lib.refreshPlayerSkills&&(lib.refreshPlayerSkills(player),game.me&&lib.refreshPlayerSkills(game.me)),lib.clearAllSkillDisplay&&lib.clearAllSkillDisplay(),lib.refreshPlayerSkills&&game.players.concat(game.dead||[]).forEach(e=>lib.refreshPlayerSkills(e)),result}function s(){const result=e.addGlobalSkill.apply(this,arguments);return[...game.players,...game.dead].forEach(e=>e.decadeUI_updateShowCards()),result}function i(){const result=e.removeGlobalSkill.apply(this,arguments);return[...game.players,...game.dead].forEach(e=>e.decadeUI_updateShowCards()),result}function l(player,card,e,event,a,r){if(!player&&!(player=_status.event.getParent().logvid))return;const t=ui.create.div(".hidden");if(t.node={},r=r||get.id(),game.broadcast((e,a,r,t,n,s)=>game.logv(e,a,r,t,n,s),player,card,e,event,a,r),"string"==typeof player){const e=Array.from(ui.historybar.childNodes).find(e=>e.logvid==player);return void(e&&e.added.push(card))}if("string"==typeof card){if("die"!=card){if(lib.skill[card]&&!1===lib.skill[card].logv&&!a)return;if(!lib.translate[card])return}let r;if(player.isUnseen(0)){if(player.isUnseen(1))return;r=player.node.avatar2.cloneNode()}else r=player.node.avatar.cloneNode();if(t.node.avatar=r,r.style.transform="",r.className="avatar","die"==card){t.dead=!0,t.player=player;const e=r.cloneNode();e.className="avatarbg grayscale1",r.appendChild(e),r.style.opacity=.6}else t.node.text=ui.create.div("",get.translation(card,"skill"),r),t.node.text.dataset.nature="water",t.skill=card;if(t.appendChild(r),"die"==card&&e&&e!=player){if(t.source=e,(player=e).isUnseen(0))if(player.isUnseen(1)){if("guozhan"!=get.mode()||!player.node||!player.node.name_seat)return;r=ui.create.div(".avatar.cardbg"),r.innerHTML=player.node.name_seat.innerHTML[0]}else r=player.node.avatar2.cloneNode();else r=player.node.avatar.cloneNode();r.style.transform="",t.node.avatar2=r,r.classList.add("avatar2"),t.appendChild(r)}}else if(Array.isArray(card)){t.cards=card[1].slice(0);const a=[(card=card[0]).suit||"",card.number||"",card.name||"",card.nature||""];if(Array.isArray(t.cards)&&t.cards.length||(t.cards=[ui.create.card(t,"noclick",!0).init(a)]),"wuxie"==card.name){if(ui.historybar.firstChild&&"wuxie"==ui.historybar.firstChild.type)return ui.historybar.firstChild.players.push(player),void ui.historybar.firstChild.cards.addArray(t.cards);t.type="wuxie",t.players=[player]}let r;if(card.copy?card.copy(t,!1):(card=ui.create.card(t,"noclick",!0)).init(a),player.isUnseen(0))if(player.isUnseen(1)){if("guozhan"!=get.mode()||!player.node||!player.node.name_seat)return;r=ui.create.div(".avatar.cardbg"),r.innerHTML=player.node.name_seat.innerHTML[0]}else r=player.node.avatar2.cloneNode();else r=player.node.avatar.cloneNode();t.node.avatar=r,r.style.transform="",r.classList.add("avatar2"),t.appendChild(r),e&&1==e.length&&e[0]!=player&&"player"==get.itemtype(e[0])&&(()=>{let a;const n=e[0];if(n.isUnseen(0))if(player.isUnseen(1)){if("guozhan"!=get.mode()||!n.node||!n.node.name_seat)return;a=ui.create.div(".avatar.cardbg"),a.innerHTML=n.node.name_seat.innerHTML[0]}else a=n.node.avatar2.cloneNode();else a=n.node.avatar.cloneNode();t.node.avatar2=a,a.style.transform="",a.classList.add("avatar2"),a.classList.add("avatar3"),t.insertBefore(a,r)})()}e&&e.length&&(1==e.length&&e[0]==player?t.targets=[]:t.targets=e);const n=decadeUI.boundsCaches.window;n.check();const s=n.height,i=Math.round((s-8)/50),l=(s-42*i)/(i+1);return t.style.transform="scale(0.8)",ui.historybar.insertBefore(t,ui.historybar.firstChild),ui.refresh(t),t.classList.remove("hidden"),Array.from(ui.historybar.childNodes).forEach((e,a)=>{a<i?e.style.transform=`scale(1) translateY(${l+a*(42+l)-4}px)`:e.removetimeout||(e.style.opacity=0,e.style.transform=`scale(1) translateY(${s}px)`,e.removetimeout=setTimeout(
/* @__PURE__ */(e=>()=>e.remove())(e),500))}),lib.config.touchscreen?t.addEventListener("touchstart",ui.click.intro):(t.addEventListener(lib.config.pop_logv?"mousemove":"click",ui.click.logv),t.addEventListener("mouseleave",ui.click.logvleave)),t.logvid=r,t.added=[],game.online||((event=event||_status.event).logvid=t.logvid),t}export{s as gameAddGlobalSkill,l as gameLogv,i as gameRemoveGlobalSkill,n as gameSwapControl,t as gameSwapPlayer,r as gameSwapSeat,a as setBaseGameMethods};
