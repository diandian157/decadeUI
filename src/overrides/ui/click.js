import{_status,game,lib,get,ui}from"noname";import{getBaseUiClickIntro as e}from"./base.js";function t(e){if(delete this._waitingfordrag,_status.dragged)return;if(_status.clicked)return;if(ui.intro)return;if(_status.clicked=!0,this.parentNode&&(this.parentNode.classList.contains("judges")||this.parentNode.classList.contains("dui-marks"))){if(!(e&&e instanceof MouseEvent)){const t=this.getBoundingClientRect(),i=game.hasExtension&&game.hasExtension("皮肤切换")?game.documentZoom:1;e={clientX:(t.left+10)*i,clientY:(t.top+10)*i}}return ui.click.touchpop(),ui.click.intro.call(this,e),void(_status.clicked=!1)}const t=_status.event.custom;if(t.replace.card)t.replace.card(this);else if(0!=this.classList.contains("selectable")){if(this.classList.contains("selected"))ui.selected.cards.remove(this),_status.multitarget||_status.event.complexSelect?(game.uncheck(),game.check()):(this.classList.remove("selected"),this.updateTransform(),1==this.dataset.view&&(this.dataset.view=0,this._tempName&&(this._tempName.delete(),delete this._tempName,this.dataset.low=0)),1==this.dataset.views&&(this.dataset.views=0,this._tempSuitNum&&(this._tempSuitNum.delete(),delete this._tempSuitNum)),decadeUI&&decadeUI.layout&&decadeUI.layout.invalidateHand());else{ui.selected.cards.add(this),this.classList.add("selected"),ui._handcardHover===this&&(ui._handcardHover=null),this.updateTransform(!0);const e=_status.event.skill;get.info(e)&&get.info(e).viewAs&&!get.info(e).ignoreMod&&function(card,e){const t="function"==typeof get.info(e).viewAs?get.info(e).viewAs([card],_status.event.player):get.info(e).viewAs,i=get.suit(card),n=get.number(card),s=get.name(card),a=get.name(t),o=get.nature(card),c=get.nature(t);let d=get.suit(t),r=get.number(t);"none"==d&&(d=i);r||(r=n);if(s!=a||!get.is.sameNature(o,c,!0)){card._tempName&&(card._tempName.delete(),delete card._tempName),card._tempName||(card._tempName=ui.create.div(".temp-name",card));let e="",t=get.translation(a);c&&(card._tempName.dataset.nature=c,"sha"==a&&(t=get.translation(c)+t)),e+=t,card._tempName.innerHTML=e,card._tempName.tempname=e,card.dataset.low=1,card.dataset.view=1}i==d&&n==r||(card._tempSuitNum&&(card._tempSuitNum.delete(),delete card._tempSuitNum),decadeUI.cardTempSuitNum(card,d,r),card.dataset.views=1)}(this,e),decadeUI&&decadeUI.layout&&decadeUI.layout.invalidateHand()}if(game.chess&&get.config("show_range")&&!_status.event.skill&&this.classList.contains("selected")&&_status.event.isMine()&&"chooseToUse"==_status.event.name){const player=_status.event.player,e=get.info(this).range;e&&("number"==typeof e.attack?player.createRangeShadow(Math.min(8,player.getAttackRange(!0)+e.attack-1)):"number"==typeof e.global&&player.createRangeShadow(Math.min(8,player.getGlobalFrom()+e.global)))}if(t.add.card&&t.add.card(),game.check(),lib.config.popequip&&"popequip"!=arguments[0]&&ui.arena&&ui.arena.classList.contains("selecting")&&this.parentNode.classList.contains("popequip")){if(this.classList&&this.classList.contains("emptyequip"))return;const e=this.getBoundingClientRect();ui.click.touchpop(),ui.click.intro.call(this.parentNode,{clientX:e.left+18,clientY:e.top+12})}}}function i(){if(!(this&&!this.extraEquip&&this.classList&&this.classList.contains("emptyequip")||this&&this.parentNode&&this.parentNode.classList&&this.parentNode.classList.contains("emptyequip")||this&&this.dataset&&"string"==typeof this.dataset.name&&this.dataset.name.startsWith("empty_equip")||this.classList.contains("infohidden"))){if(!(this.classList.contains("card")&&this.parentNode&&this.parentNode.classList.contains("equips")&&get.is.phoneLayout())||get.is.mobileMe(this.parentNode.parentNode))return e()?.apply(this,arguments);n.call(this,arguments[0])}}function n(e){if(_status.dragged)return;if(_status.clicked=!0,this.classList.contains("player")&&!this.name)return;if(this.parentNode==ui.historybar){if("22"==ui.historybar.style.zIndex){if(!_status.removePop)return;if(0==_status.removePop(this))return}ui.historybar.style.zIndex=22}const t=get.nodeintro(this,!1,e);if(!t)return;t.classList.add("popped"),t.classList.add("static"),ui.window.appendChild(t);const i=ui.create.div(".poplayer",ui.window),n=function(e){if(!_status.touchpopping)return delete ui.throwEmotion,delete _status.removePop,game.closePoptipDialog(),t.delete(),this.remove(),ui.historybar.style.zIndex="",delete _status.currentlogv,ui.arena.classList.contains("menupaused")||t.noresume||game.resume2(),e&&e.stopPropagation&&e.stopPropagation(),t._onclose&&t._onclose(),!1};if(i.addEventListener(lib.config.touchscreen?"touchend":"click",n),lib.config.touchscreen||(i.oncontextmenu=n),this.parentNode==ui.historybar&&lib.config.touchscreen){e={clientX:0,clientY:this.getBoundingClientRect().top+30}}lib.placePoppedDialog(t,e),this.parentNode==ui.historybar&&("right"==lib.config.show_history?(t.style.left="calc(100% - 10px)",t.style.right="auto"):(t.style.right="calc(100% - 10px)",t.style.left="auto"))}function s(e){if(_status.dragged||!game.getIdentityList||_status.video||this.parentNode.forceShown)return;_status.clicked=!0;let t=game.getIdentityList(this.parentNode);if(t)if("click"==lib.config.mark_identity_style){let e,i=!1;const n=this.firstChild.innerText;for(const s in t){if((null===e||i)&&(e=s,i))break;n===t[s]&&(i=!0)}this.parentNode.setIdentity(e)}else"guozhan"==get.mode()&&(t={wei:"魏",shu:"蜀",wu:"吴",qun:"群",jin:"晋",ye:"野"},_status.forceKey&&(t.key="键")),a.call(this,t)}function a(e){const t=window.decadeUI;t.$identityMarkBox||(t.$identityMarkBox=window.decadeUI.element.create("identity-mark-box"),t.$identityMarkBox.ondeactive=function(){t.$identityMarkBox.remove(),_status.clicked=!1,ui.arena.classList.contains("menupaused")||game.resume2()});let i,n=0;const s=t.$identityMarkBox.childNodes;for(const a in e)i=s[n],i?i.style.display="":(i=window.decadeUI.element.create("identity-mark-item",t.$identityMarkBox),i.addEventListener(lib.config.touchscreen?"touchend":"click",function(){this.player.setIdentity(this.link),t.$identityMarkBox.remove(),_status.clicked=!1})),i.link=a,i.player=this.parentNode,i.innerText=e[a],n++;for(;n<s.length;)s[n].style.display="none",n++;game.pause2(),setTimeout(function(player){player.appendChild(t.$identityMarkBox),t.set.activeElement(t.$identityMarkBox)},0,this.parentNode)}function o(){const e=ui.create.dialog("hidden");e.listen(function(e){e.stopPropagation()});const t=window.decadeUI.component.slider(0,8,parseInt(lib.config.volumn_background)),i=window.decadeUI.component.slider(0,8,parseInt(lib.config.volumn_audio));return t.onchange=function(){game.saveConfig("volumn_background",t.value),ui.backgroundMusic.volume=t.value/8},i.onchange=function(){game.saveConfig("volumn_audio",i.value)},e.add("背景音量"),e.content.appendChild(t),e.add("游戏音量"),e.content.appendChild(i),e.add(ui.create.div(".placeholder")),e}export{t as uiClickCard,s as uiClickIdentity,i as uiClickIntro,o as uiClickVolumn};
