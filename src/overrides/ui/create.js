import{game,ui,lib,get,_status}from"noname";import{getBaseUiCreateCharacterDialog as e,getBaseUiCreatePause as t,getBaseUiCreateArena as n,getBaseUiCreateButton as o}from"./base.js";import{uiUpdatez as a}from"./update.js";function i(e,t,n,o){const a=ui.create.div();return a.style.display="none",a.link=e,a.activate=function(){ui.create.button(e,t,void 0,o,a).activate=void 0},_status.prebutton.push(a),n&&n.appendChild(a),a}function r(e){if(!lib.config.show_rarity)return;const t=game.getRarity(e.link),n=e.node.intro;n.classList.add("showintro"),n.classList.add("rarity"),n.innerText&&(n.innerText=""),n.style.backgroundImage='url("'+decadeUIPath+"image/ui/rarity/rarity_"+t+'.png")'}function c(){let e;e=Array.isArray(arguments[0])?arguments[0]:arguments;const t=document.createElement("div");t.className="control",t.style.opacity=1,Object.setPrototypeOf(t,lib.element.Control.prototype);for(let n=0;n<e.length;n++)"function"==typeof e[n]?t.custom=e[n]:"nozoom"==e[n]||("stayleft"==e[n]?(t.stayleft=!0,t.classList.add("stayleft")):t.add(e[n]));return ui.controls.unshift(t),ui.control.insertBefore(t,_status.createControl||ui.confirm),t.addEventListener(lib.config.touchscreen?"touchend":"click",ui.click.control2),t}function s(...e){let t=!1,n=!1,o=!1,a=!1,i=!1;const r=decadeUI.element.create("dialog");r.supportsPagination=!1,r.paginationMap=/* @__PURE__ */new Map,r.paginationMaxCount=/* @__PURE__ */new Map,r.contentContainer=decadeUI.element.create("content-container",r),r.content=decadeUI.element.create("content",r.contentContainer),r.buttons=[],Object.setPrototypeOf(r,lib.element.Dialog.prototype);for(let c=0;c<e.length;c++)"boolean"==typeof e[c]?r.static=e[c]:"hidden"==e[c]?t=!0:"notouchscroll"==e[c]?n=!0:"forcebutton"==e[c]?o=!0:"noforcebutton"==e[c]?a=!0:"peaceDialog"==e[c]?i=!0:r.add(e[c]);return t||r.open(),lib.config.touchscreen||(r.contentContainer.onscroll=ui.update),n||(r.contentContainer.ontouchstart=ui.click.dialogtouchStart,r.contentContainer.ontouchmove=ui.click.touchScroll,r.contentContainer.style.WebkitOverflowScrolling="touch",r.ontouchstart=ui.click.dragtouchdialog),a?r.noforcebutton=!0:o&&(r.forcebutton=!0,r.classList.add("forcebutton")),i&&(r.peaceDialog=!0),r}function d(e,t,n,o){const a=document.createElement("select");for(let i=0;i<e.length;i++){const n=document.createElement("option");Array.isArray(e[i])?(n.value=e[i][0],n.innerText=e[i][1]):(n.value=e[i],n.innerText=e[i]),t==n.value&&(n.selected="selected"),a.appendChild(n)}return n&&n.appendChild(a),o&&(a.onchange=o),a}function l(e,t,n,o){const card=ui.create.card(t,n,o);card.removeEventListener(lib.config.touchscreen?"touchend":"click",ui.click.card),card.classList.add("button"),card._customintro=function(t){t.add(`${get.translation(e+2)}的身份牌`)};const a="extension/十周年UI/image/ui/identity-card/mougong_"+e+".jpg";return new Promise((e,t)=>{const n=new Image;n.onload=()=>e(),n.onerror=t,n.src=`${lib.assetURL}${a}`}).then(()=>{card.classList.add("fullimage"),card.setBackgroundImage(a),card.style.backgroundSize="cover"}).catch(()=>{card.node.background.innerHTML=get.translation(e)[0]}),card}function u(e,t){const card=ui.create.identityCard(e),n=ui.create.div(".buttons",t.content);setTimeout(()=>{n.appendChild(card),t.open(),ui.create.cardSpinning(card)},50)}function p(e,t,n,a,i){const r=o()?.apply(this,arguments);return n&&n.appendChild(r),r}function h(){a();const result=n()?.apply(this,arguments);return ui.arena.classList.remove("slim_player"),ui.arena.classList.remove("uslim_player"),ui.arena.classList.remove("mslim_player"),ui.arena.classList.remove("lslim_player"),ui.arena.classList.remove("oldlayout"),ui.arena.classList.remove("mobile"),ui.arena.classList.add("decadeUI"),ui.control.id="dui-controls",lib.config.phonelayout?ui.arena.setAttribute("data-phonelayout","on"):ui.arena.setAttribute("data-phonelayout","off"),decadeUI.config.update(),result}function m(){const e=t()?.call(this);return e.style.backgroundColor="rgba(0, 0, 0, 0.4)",e}function f(){const t=e()?.apply(this,arguments),n=lib.config.extension_十周年UI_mx_decade_characterDialog||"default";if("default"!=n){const e=t.querySelector(".searcher.caption");e&&e.parentNode.removeChild(e),"extension-OL-system"==n&&function(e){const t=e.childNodes[0],n=t.childNodes[0],o=n.childNodes[0],a=n.childNodes[1],i=ui.create.div("extension-OL-system");i.style.cssText="display: flex; justify-content: center; align-items: center; gap: 6px; height: 35px; width: 100%; padding: 0 5px; top: -2px; left: 0; font-size: 18px; font-family: xinwei, sans-serif; box-sizing: border-box;",i.innerHTML='\n\t\t<label style="font-size:20px;">搜索：</label>\n\t\t<select style="height:26px; min-width:150px; font-size:15px; padding:1px 4px; border:1px solid #aaa; border-radius:4px; outline:none; flex-shrink:0;">\n\t\t\t<option value="name">名称翻译</option>\n\t\t\t<option value="name1">名称ID</option>\n\t\t\t<option value="name2">名称ID(精确匹配)</option>\n\t\t\t<option value="skill">技能翻译</option>\n\t\t\t<option value="skill1">技能ID</option>\n\t\t\t<option value="skill2">技能ID(精确匹配)</option>\n\t\t\t<option value="skill3">技能描述/翻译</option>\n\t\t</select>\n\t\t<input type="text" placeholder="非精确匹配支持正则搜索" style="height:24px; width:175px; font-size:15px; padding:1px 6px; border:1px solid #aaa; border-radius:4px; outline:none; flex-shrink:0; text-align:center;"/>\n\t\t<button style="height:26px; padding:0 10px; font-size:15px; border:1px solid #aaa; border-radius:4px; background:#f5f5f5; cursor:pointer;">搜索</button>\n\t';const r=i.querySelector("input"),c=i.querySelector("select"),s=i.querySelector("button");function d(){const t=r.value.trim();if(!t)return game.alert("搜索不能为空"),void r.focus();const n=c.value;for(let e=0;e<a.childNodes.length;e++){const o=a.childNodes[e];o.classList.add("nodisplay");const i=o.link;g(n,t,i,get.character(i).skills||[])&&o.classList.remove("nodisplay")}if(e.paginationMaxCount.get("character")){const t=e.content.querySelector(".buttons"),n=e.paginationMap.get(t);if(n){const t=e.buttons.filter(e=>!e.classList.contains("nodisplay"));n.state.data=t,n.setTotalPageCount(Math.ceil(t.length/e.paginationMaxCount.get("character")))}}}r.addEventListener("keydown",e=>{e.stopPropagation(),"Enter"!==e.key&&13!==e.keyCode||(e.preventDefault(),d())}),s.addEventListener("click",e=>{e.stopPropagation(),d(),r.focus()}),r.addEventListener("mousedown",e=>{e.stopPropagation()}),o.insertBefore(i,o.firstChild)}(t)}return t}function g(e,t,n,o){if(e.endsWith("2"))return"name2"===e?t===n:o.includes(t);let a;try{a=new RegExp(t,"i")}catch{return game.alert("正则表达式无效"),!1}const i=e=>e&&a.test(e);return"name1"===e?i(n):"name"===e?i(get.translation(n))||i(get.translation(n+"_ab")):"skill1"===e?o.some(e=>i(e)):"skill"===e?o.some(e=>i(get.translation(e))):o.some(e=>i(get.translation(e+"_info")))}function y(e){ui.arena.dataset.layout=game.layout,ui.mebg=ui.create.div("#mebg",ui.arena),ui.me=ui.create.div(".hand-wrap",ui.arena),ui.handcards1Container=window.decadeUI.element.create("hand-cards",ui.me),ui.handcards1Container.onmousewheel=window.decadeUI.handler.handMousewheel,ui.handcards2Container=ui.create.div("#handcards2"),ui.arena.classList.remove("nome");const t=ui.equipSolts=window.decadeUI.element.create("equips-wrap");t.back=window.decadeUI.element.create("equips-back",t);for(let n=0;n<5;n++){window.decadeUI.element.create(null,t.back).dataset.type=n}ui.arena.insertBefore(t,ui.me),lib.config.extension_十周年UI_aloneEquip||(t.style.display="none"),window.decadeUI.bodySensor.addListener(()=>window.decadeUI.layout.resize()),window.decadeUI.layout.resize(),ui.handcards1Container.ontouchstart=ui.click.touchStart,ui.handcards2Container.ontouchstart=ui.click.touchStart,ui.handcards1Container.ontouchmove=ui.click.touchScroll,ui.handcards2Container.ontouchmove=ui.click.touchScroll,ui.handcards1Container.style.WebkitOverflowScrolling="touch",ui.handcards2Container.style.WebkitOverflowScrolling="touch",e&&game.me?(ui.handcards1=game.me.node.handcards1,ui.handcards2=game.me.node.handcards2,ui.handcards1Container.appendChild(ui.handcards1),ui.handcards2Container.appendChild(ui.handcards2)):game.players.length&&(game.me=game.players[0],ui.handcards1=game.me.node.handcards1,ui.handcards2=game.me.node.handcards2,ui.handcards1Container.appendChild(ui.handcards1),ui.handcards2Container.appendChild(ui.handcards2)),lib.config.extension_十周年UI_aloneEquip&&game.me&&(t.me=game.me,t.equips=game.me.node.equips,t.appendChild(game.me.node.equips))}export{h as uiCreateArena,p as uiCreateButton,f as uiCreateCharacterDialog,c as uiCreateControl,s as uiCreateDialog,l as uiCreateIdentityCard,y as uiCreateMe,m as uiCreatePause,i as uiCreatePrebutton,r as uiCreateRarity,d as uiCreateSelectlist,u as uiCreateSpinningIdentityCard};
