import{lib}from"noname";import{cardSkinMeta as e}from"../../config/utils.js";import{generateSkinFilename as s,isSkinPreloaded as c,getSkinCache as a,getFallbackKey as r,getFallbackSkinUrl as d,createSkinAsset as o,buildSkinUrl as n,loadSkinImage as t,loadFallbackSkin as i}from"./skin-loader.js";function l(e,s){e.style.background=`url("${s}")`,e.classList.add("decade-card")}function u(u,card){const f=Array.isArray(card)?card[2]:card.name,m=Array.isArray(card)?card[3]:card.nature,{skinKey:y,isOff:g}=function(){const e=lib.config.extension_十周年UI_cardPrettify;return{skinKey:e,isOff:!e||"off"===e}}();if(u.classList.remove("decade-card"),g)return void function(e){e.classList.remove("decade-card"),e.style.removeProperty("background")}(u);if(!e[y])return;if(function(e){e._decadeRawBg||(e._decadeRawBg=e.style.backgroundImage||e.style.background||"")}(u),u.classList.add("decade-card"),u.classList.contains("infohidden"))return;const k=s(f,m);c(y)?function(e,s,c){const o=a(s)[c],n=r(s);if(void 0===o){const s=d(n,c);s?l(e,s):e.classList.remove("decade-card")}else o?.url?l(e,o.url):e.classList.remove("decade-card")}(u,y,k):function(e,s,c){const d=a(s);let u=d[c];const f=r(s);if(!0===u?.loaded&&u.url)l(e,u.url);else if(!1!==u?.loaded){if(u||(u=o(c),d[c]=u),void 0===u.loaded){const a=n(s,c),r=e._decadeRawBg||"";t({url:a,asset:u,onSuccess:()=>{},onError:()=>{f?i({asset:u,fallbackKey:f,filename:c,onSuccess:s=>{e.style.background=`url("${s}")`},onFail:()=>{e.style.background=r,e.classList.remove("decade-card")}}):(u.loaded=!1,e.style.background=r,e.classList.remove("decade-card"))}}),e.style.background=`url("${a}")`}}else e.classList.remove("decade-card")}(u,y,k)}function f(card,e,s,c){const a=card._decadeRawBg||"";if(!s)return card.style.background=a,void card.classList.remove("decade-card");const r=d(s,c);r?card.style.background=`url("${r}")`:(card.style.background=a,card.classList.remove("decade-card"))}function m(card){card&&u(card,card)}export{u as applyCardSkin,f as handleSkinFallback,m as refreshCardSkin};
