import{lib,_status,get,ui,game}from"noname";function e(){lib.hooks.checkTarget.push(function(e){e.classList[["selected","selectable"].some(t=>e.classList.contains(t))?"remove":"add"]("un-selectable")});const e=lib.hooks.checkCard.indexOf(lib.hooks.checkCard.find(e=>"updateTempname"===e.name));lib.hooks.checkCard[e]=function(card){if("off"===lib.config.cardtempname)return;const e=_status.event.skill;let t,n,o;if(e&&get.info(e)?.viewAs&&!get.info(e).ignoreMod&&(ui.selected.cards||[]).includes(card)?(o="function"==typeof get.info(e).viewAs?get.info(e).viewAs([card],_status.event.player||game.me):get.info(e).viewAs,t=get.name(o),n=get.nature(o)):(t=get.name(card),n=get.nature(card)),card.name!==t||!get.is.sameNature(card.nature,n,!0)){card._tempName||(card._tempName=ui.create.div(".temp-name",card));let e=get.translation(t);n&&(card._tempName.dataset.nature=n,"sha"===t&&(e=get.translation(n)+e)),card._tempName.innerHTML=e,card._tempName.tempname=e,card.dataset.low=1}const a=get.number(card),s=get.suit(card);1==card.dataset.views||card.number==a&&card.suit==s||decadeUI.cardTempSuitNum(card,s,a)},lib.hooks.checkEnd.push(function(){if("chooseToUse"!==_status.event?.name||"phase"!==_status.event.type||"cancel"!==ui.confirm?.lastChild.link)return;const e=lib.config.extension_十周年UI_newDecadeStyle;let t="othersOff"!==e||"on"===e?"回合结束":"结束出牌";"onlineUI"===e?t="取消":_status.event.skill||(ui.selected?.cards??[]).length>0?t="off"===e?`<img draggable='false' src=${lib.assetURL}extension/十周年UI/ui/assets/lbtn/uibutton/QX.png>`:"取消":"off"===e&&(t=`<img draggable='false' src=${lib.assetURL}extension/十周年UI/ui/assets/lbtn/uibutton/jscp.png>`),ui.confirm.lastChild.innerHTML=t;const n=ui.confirm.custom;ui.confirm.custom=function(...e){"function"==typeof n&&n(...e),ui.cardDialog&&(ui.cardDialog.close(),delete ui.cardDialog)}});const t=lib.hooks.uncheckCard.indexOf(lib.hooks.uncheckCard.find(e=>"removeTempname"===e.name));lib.hooks.uncheckCard[t]=function(card){card._tempName&&(card._tempName.delete(),delete card._tempName,card.dataset.low=0,card.dataset.view=0),card._tempSuitNum&&(card._tempSuitNum.delete(),delete card._tempSuitNum,card.dataset.views=0),decadeUI?.layout&&decadeUI.layout.invalidateHand()},lib.hooks.uncheckTarget.push(function(e){e.classList.remove("un-selectable")});const n=lib.hooks.checkOverflow.indexOf(lib.hooks.checkOverflow.find(e=>"updateDialog"===e.name));lib.hooks.checkOverflow[n]=function(e,t,n,o){const a=t.originWidth/o.documentZoom,s=n[0].getBoundingClientRect().width/o.documentZoom,c=n.length;if(c*s+5*(c+1)<a)t.style.setProperty("--ml","5px");else{const e=Math.min((c*s-a+30*c)/(c-1),s+20/o.documentZoom);t.style.setProperty("--ml","-"+e+"px")}}}export{e as initHooks};
