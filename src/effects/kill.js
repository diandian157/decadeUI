import{game,ui}from"noname";import{CONFIG as e}from"./config.js";import{isPlayer as t,getAvatar as n,create as a,randomPosition as o}from"./utils.js";function s(s,r){if(!t(s)||!t(r))throw new Error("source和target必须是有效的玩家对象");if(s===r||s.isUnseen()||r.isUnseen())return;const i=n(s,s.isUnseen(0)),c=n(r,r.isUnseen(0)),l=a("effect-window",null,{backgroundColor:"rgba(0,0,0,0.7)",transition:"all 4s",zIndex:7}),d=a("killer-warpper",l);d.killer=a("killer",d),d.killer.style.backgroundImage=i.style.backgroundImage;const u=a("victim",l);u.back=a("back",u),u.back.part1=a("part1",u.back),u.back.part2=a("part2",u.back);const f=c.style.backgroundImage;u.back.part1.style.backgroundImage=f,u.back.part2.style.backgroundImage=f,game.playAudio("../extension",decadeUI.extensionName,"audio/kill_effect_sound.mp3");const p=decadeUI.animation,g=p.getSpineBounds("effect_jisha1");if(g){const t=p.canvas.width/g.size.x*e.KILL_SCALE,n=p.canvas,a=n.style.zIndex;n.style.zIndex=10,p.playSpine("effect_jisha1",{scale:t}),ui.window.appendChild(l),ui.refresh(l),setTimeout(()=>{n.style.zIndex=a},e.KILL_CLOSE)}else!function(t,n){a("li-big",t),n.rout=a("rout",n),n.rout2=a("rout",n),n.rout.innerHTML="破敌",n.rout2.innerHTML="破敌",n.rout2.classList.add("shadow"),ui.window.appendChild(t);const s=ui.window.offsetHeight;for(let r=0;r<e.KILL_LIGHT_COUNT;r++){const{x:e,y:n,scale:r}=o(s);setTimeout(()=>{a("li",t).style.transform=`translate(${e}, ${n}) scale(${r})`},decadeUI.getRandom(50,300))}}(l,u);decadeUI.delay(e.KILL_DELAY),l.style.backgroundColor="rgba(0,0,0,0)",l.close(e.KILL_CLOSE)}export{s as playKillEffect};
