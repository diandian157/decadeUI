import{lib,ui}from"noname";let t=!1,e=!0;const n=/* @__PURE__ */new Set;let o=null,a=0;const r=[];function s(card){const t=card.getBoundingClientRect();if(0===t.width||0===t.height)return;const e=function(){if(r.length>0)return r.pop();const t=document.createElement("div");return t.className="card-ghost-trail",t}(),n=getComputedStyle(card).backgroundImage,o=ui.arena.getBoundingClientRect(),a=o.width/ui.arena.offsetWidth||1,s=o.height/ui.arena.offsetHeight||1,i=(t.left-o.left)/a+ui.arena.scrollLeft,c=(t.top-o.top)/s+ui.arena.scrollTop;e.style.cssText=`\n\t\tposition: absolute;\n\t\tleft: ${i}px;\n\t\ttop: ${c}px;\n\t\twidth: ${t.width/a}px;\n\t\theight: ${t.height/s}px;\n\t\tbackground-image: ${n};\n\t\tbackground-size: cover;\n\t\tbackground-position: center;\n\t\tborder-radius: 4px;\n\t\tpointer-events: none;\n\t\tz-index: 1;\n\t\topacity: 0.5;\n\t\tbox-shadow: 0 0 12px rgba(255, 0, 0, 0.53);\n\t\tfilter: blur(1px);\n\t`,ui.arena.appendChild(e),requestAnimationFrame(()=>{e.style.transition="opacity 300ms ease-out, transform 300ms ease-out",e.style.opacity="0",e.style.transform="scale(0.85)"}),setTimeout(()=>function(t){t.parentNode&&t.parentNode.removeChild(t),t.style.cssText="",t.style.transition="",t.style.opacity="",t.style.transform="",r.length<30&&r.push(t)}(e),350)}function i(){if(0===n.size)return void(o=null);const t=Date.now();t-a>=10&&(a=t,n.forEach(card=>{if(!card.parentNode)return void n.delete(card);const t=card.getBoundingClientRect(),e=card._ghostLastPos;if(e){const n=Math.abs(t.left-e.x),o=Math.abs(t.top-e.y);(n>2||o>2)&&s(card)}card._ghostLastPos={x:t.left,y:t.top}})),o=requestAnimationFrame(i)}function c(card,t=800){e&&card&&(!function(card){e&&card&&!n.has(card)&&(card._ghostLastPos=null,n.add(card),null===o&&(a=0,o=requestAnimationFrame(i)))}(card),setTimeout(()=>function(card){n.delete(card),delete card._ghostLastPos}(card),t))}function d(){var n;t||(t=!0,e=!1!==lib.config["extension_十周年UI_cardGhostEffect"],function(){const t="decade-card-ghost-styles";if(document.getElementById(t))return;const e=document.createElement("style");e.id=t,e.textContent="\n\t\t.card-ghost-trail {\n\t\t\twill-change: opacity, transform;\n\t\t}\n\t",document.head.appendChild(e)}(),lib.element?.player?.$throwordered2&&(lib.element.player.$throwordered2=(n=lib.element.player.$throwordered2,function(card){const result=n.apply(this,arguments);return e&&card&&!card.classList?.contains("card-ghost-trail")&&requestAnimationFrame(()=>c(card,1e3)),result})),setTimeout(()=>{window.decadeUI?.layoutDrawCards&&!window.decadeUI._ghostHooked&&(window.decadeUI._ghostHooked=!0,window.decadeUI.layoutDrawCards=function(t){return function(n){const result=t.apply(this,arguments);if(e&&n){const t=Array.isArray(n)?n:[n];requestAnimationFrame(()=>{t.forEach(card=>{card&&!card.classList?.contains("card-ghost-trail")&&c(card,600)})})}return result}}(window.decadeUI.layoutDrawCards))},100))}function l(t){e=!!t,e||n.clear()}export{c as addGhostTrail,l as setGhostEffectEnabled,d as setupCardGhost};
