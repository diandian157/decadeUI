import{lib,_status,ui,game}from"noname";const t=300,e=800,i=30,s=30,n=100,o="99999",a="#5bc0de",l="#f0ad4e",r="120px";function d(t,e){const i=t.split(".").map(Number),s=e.split(".").map(Number),n=Math.max(i.length,s.length);for(let o=0;o<n;o++){const t=i[o]||0,e=s[o]||0;if(t!==e)return t>e?1:-1}return 0}function h(){const i=lib.version,s=lib.extensionPack.十周年UI.minNonameVersion,n=d(i,s);0!==n&&(_status.decadeVersionMismatch=!0,setTimeout(()=>{const t=function(t,e){return-1===t?{message:`无名杀本体过低，请下载${e}离线包或完整包。`,links:[{text:"前往GitHub下载",href:"https://github.com/libnoname/noname/releases"}]}:{message:"十周年UI版本过低，请下载新版本：",links:[{text:"QQ群聊 985914900",href:"https://qm.qq.com/q/QsKh0KIYGA"},{text:"GitHub仓库",href:"https://github.com/diandian157/decadeUI"}]}}(n,s);var i;i=t,lib.arenaReady?lib.arenaReady.push(()=>c(i)):setTimeout(()=>c(i),e)},t))}function c(t){const e=function(){const t=()=>{ui.dialogs&&ui.dialogs.length>0&&ui.dialogs.forEach(t=>{"none"!==t.style.display&&(t.style.display="none")})};return t(),setInterval(t,i)}();if(!ui.dialogs)return void setTimeout(()=>{clearInterval(e),c(t)},n);clearInterval(e);const s=function(t){const e=ui.create.dialog("forcebutton");return e.classList.add("fixed"),e.style.zIndex=o,e.static=!0,function(t,e){t.add(`<div class="text center" style="line-height: 1.8;">${e.message}</div>`);const i=function(t){const e=ui.create.div(".text.center");return e.style.cssText="margin: 15px 0;",t.forEach((t,i)=>{i>0&&e.appendChild(document.createTextNode(" 或 "));const s=document.createElement("a");s.href=t.href,s.target="_blank",s.textContent=t.text,s.style.cssText=`color: ${a}; text-decoration: underline; margin: 0 10px; font-size: 16px;`,e.appendChild(s)}),e}(e.links);t.add(i),t.add(`<div class="text center" style="color: ${l}; margin-top: 15px;">点击确定继续游戏，但遇到的问题均不受理</div>`);const s=function(t){const e=ui.create.div(".menubutton.large","确定",()=>{t.close(),game.print("已确认版本不匹配，继续游戏...")});return e.style.cssText=`margin: 15px auto 0; width: ${r};`,e}(t);t.add(s)}(e,t),e}(t);new g(s).show()}class g{constructor(t){this.dialog=t,this.hiddenDialogs=[],this.checkInterval=null}show(){this.dialog.open(),this.hideOtherDialogs(),this.startMonitoring(),this.overrideCloseMethod()}hideOtherDialogs(){ui.dialogs.forEach(t=>{t===this.dialog||"none"===t.style.display||this.hiddenDialogs.includes(t)||(this.hiddenDialogs.push(t),t.style.display="none")})}keepOnTop(){this.dialog.parentNode&&ui.dialogs.includes(this.dialog)&&(ui.dialogs[0]!==this.dialog&&(ui.dialogs.remove(this.dialog),ui.dialogs.unshift(this.dialog),this.dialog.show(),this.dialog.refocus()),this.hideOtherDialogs())}startMonitoring(){this.checkInterval=setInterval(()=>{this.dialog.parentNode?this.keepOnTop():this.stopMonitoring()},s)}stopMonitoring(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}restoreHiddenDialogs(){this.hiddenDialogs.forEach(t=>{t.parentNode&&(t.style.display="")}),this.hiddenDialogs=[]}overrideCloseMethod(){const t=this.dialog.close.bind(this.dialog);this.dialog.close=()=>(this.stopMonitoring(),this.restoreHiddenDialogs(),t())}}export{h as checkVersionCompatibility,d as compareVersions};
