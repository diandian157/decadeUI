name: 自动发布

on:
    push:
        tags:
            - "v*"

jobs:
    release:
        runs-on: ubuntu-latest

        steps:
            - name: 检出代码
              uses: actions/checkout@v4

            - name: 创建发布包
              run: |
                  # 排除不需要的文件
                  zip -r decadeUI.zip . \
                    -x "*.git*" \
                    -x "*.github*" \
                    -x "*.vscode*" \
                    -x "node_modules/*" \
                    -x "*.md" \
                    -x "LICENSE"

            - name: 获取版本号
              id: get_version
              run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

            - name: 读取更新日志
              id: changelog
              run: |
                  if [ -f "CHANGELOG.md" ]; then
                    echo "CHANGELOG<<EOF" >> $GITHUB_OUTPUT
                    cat CHANGELOG.md >> $GITHUB_OUTPUT
                    echo "EOF" >> $GITHUB_OUTPUT
                  else
                    echo "CHANGELOG=版本 ${{ steps.get_version.outputs.VERSION }}" >> $GITHUB_OUTPUT
                  fi

            - name: 创建 Release
              uses: softprops/action-gh-release@v1
              with:
                  files: decadeUI.zip
                  body: ${{ steps.changelog.outputs.CHANGELOG }}
                  draft: false
                  prerelease: false
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
